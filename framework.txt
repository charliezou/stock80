一、规整模块接口
1、属性接口：
   analyze_result=analyze(pricedata、成交量data、大盘指标data、。。。）---dict
   属性1 = analyze_result.get（****）

2、预测接口：
   forest_result=forest(pricedata、成交量data、大盘指标data、。。。）---dict  
   预测结果 = forest_result.get(****) 


二、APP函数功能
1、获取数据功能
   类：StockDataMgr -> 下载、更新、读取cvs     
   类：StockSymbol -> instrument的syboml,syboml的基本信息（名称、行业、市值、市盈率、股息收益率） 
   类：StockMetaDB -> 对元数据的保存：syboml、市场、instrument、更新日期

   性能：pd数据放在缓冲池；

   - 获取代码和代码基础信息
      get_instrument_symbols("CSI300") -> list
      get_symbol_baseinfo("600519.ss", "cn") -> dict
   - 获取和更新数据（日、周）
   StockDataMgr：
      download("SZ600519","cn",start=start，qlib=False) -> True（下载、保存csv、更新meta）
      batch_download([("SZ600519","cn"),(...)], start=start) -> 成功list, 失败List
      download_instrument_symbols("CSI300") -> 成功list, 失败List（读代码表，调用下载）
      delete_symbol("SZ600519")
  StockSymbol:
      get_symbol("SS600519","cn", day/week) -> pd 
      get_symbols([（"SS600519","cn"），(...)], day/week) -> dict
      get_instrument_symbols("CSI300", day/week) -> dict 
      get_instrument("CSI300") -> list
      get_info("SS600519","cn") -> dict     
  StockMetaDB：
      _create_tables
      update
      delete
      getall

  

2、辅助函数
  UtilsAnalyzer
   - 生成包咯线数据
    extract_envelope(pd) -> pd
   - 寻找包咯线峰谷
    find_peaks(pd) -> list: [(date1,P),(date2,V),(...)]
   - 归一化和还原
    normalization(pd) -> pd 
    unnormalization(pd) -> pd
   - 年化收益率
    annualized_returns(pd, years) -> list: [(year, return),]
   - 盈利稳定系数
    growth_scores(pd, years, peaks=None) -> list: [(year, scores),]

3、价格预测函数
   -未来值预测
   - predict_dwt(runconfig:dict, symbols,  pd) -> pred_pd, dict
      runconfig: dtw_model, x_stamp, y_stamp, lookback, pred_len;支持包洛线；组合大盘曲线；
   - predict_kronos(runconfig:dict, symbols,  pd) -> pred_pd, dict
    - runconfig: kronos_model, x_stamp, y_stamp, lookback, pred_len；;支持包洛线
       
   - batch_predict_dtw(runconfig:dict, [(symbols, pd),]) -> dict (symbol:pd, dict)
   - batch_predict_kronos(runconfig:dict, [(symbols, pd),]) -> dict (symbol:pd, dict)

   -准确性评估
    - 给定数据，确认测试区间段，对测试区间段每一点进行模型预测，返回[(lookback1,pred1,true1),...]
    - 计算归一化后的RMSE、方向准确率；
    
4、行情预测函数
  - analysis_situation(runconfig:dict,market, index/symbol) -> result: dict
     -运行周期：（谷峰下行 -> 筑底期 ->波谷上行 -> 筑峰期）、V值（当前值与上一个峰值的距离）、置信度；
     -runconfig:model、x_stamp 
      base模式: 生成包咯线数据 -> 定位最近一个峰值点、V值 -> 确定运行周期 -> 根据dtw寻找相似历史数据（可结合成交量、高开低走\低开高走值） -> 计算置信度
      模式2: 调用价格预测函数 -> 生成包咯线数据 -> 计算当前点运行周期、V值 -> 根据dtw寻找相似历史数据 -> 计算置信度
      模式3 - 调用AI返回行情

  - 准确性评估
    - 给定数据，确认测试区间段，对测试区间段每一点进行模型预测，返回[(lookback1,pred_运行周期，pred_V1,true_运行周期),...]
    - 计算V1值准确率、周期准确率；       

6、TopN预测函数
  - 股票排序函数
    - 模式1: 调用价格预测模型；last、min、max、mean作为得分 -> 获得排序
    - 模式2: 调用行情预测函数；运行周期+V值+置信度 -> 获得排序
    - 模式3: 调用AI进行打分 -> 返回排序

    -准确性评估
      -P(n):预测Top n的Item准确命中实际在Top n的数量/n；(P(1)+...+P(N)/N
      -整体相关性：SRCC：1 - 6*（di^2)/(n*(n^2-1));di为第i个元素在预测和实际的排序位置差；

7、回测函数
  - 单股票回测函数
    SingleBackTest(model, symbol, pd,...)
      - 价格预测(每隔N周) ->预测值下个N周的last值，下降卖出，上升买入/持有；周模型或者天模型
      - 行情预测：筑底期/波谷上行建仓；筑峰期/波谷下行减仓；一次性/逐步建仓减仓策略；周模型
      - 价格预测+行情预测组合: 股票预测 + 大盘/股票行情 ；
  
  - TopN回测函数
     TopNBackTest(model, symbols, pdList,...)
      - 每隔N周预测：根据排序值，从股票池中选择TopN建仓，定期DropK；

8、发现函数
  - 发现领头羊行业函数
    -find__bellwether_sector 
  - 发现领头羊股票函数
    -find_bellwether_stock（行业、年投资收益、盈利稳定系数、股息收益、市盈率、股息收益率、市值）
  - 发现起飞行业函数
    -find_takeoff_sector
  - 发现起飞股票函数
    -find_takeoff_stock

三、UI
1、数据管理
   - 单股下载/更新
   - 批量下载/更新
   目录结构
     - data
         -pool:CSI300.txt;...,<selfname>.txt
         -cn-stock:<symbol>_day.csv;<symbol>_week.csv;
         -metadata.db(下载记录，股票信息)

2、属性分析
   - 股票信息
   - 趋势图

3、价格预估
   预估验证

4、行情预估
   预估验证

5、模型回测

6、智能发现

7、工具
   qlib更新

 a、属性汇总模块（文字）
   --名称、上市日期、市值、市盈率
   --成长性
   --稳定性

   --股票温度：近期表现、当前处于什么周期；确定性


 b、大盘指数
   --市值、市盈率
   --成长性
   --稳定性

   --大盘温度，近期表现、当前处于什么周期（谷底>谷底上行>上行接近谷峰->谷峰>谷峰下行->接近谷底）；确定性（谷底和谷峰确定性底）

 c、自动选股模型
   --检验模型：属性指标->未来（半年/一年）表现最佳的股票；每个市场的top6；指定板块的top3
   --注意：当前好不等于未来好，要检验处于什么周期

 d、操作模型
   --选择N股（自动选股模型）
   --大盘温度
     --高：买入：N中选择其中之2；周期性换股。（1、预测模型；2、deepseek选股）
     --低：卖出
   --回测功能

 

	

 


    

